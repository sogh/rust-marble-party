# Session Log - 2026-01-08

## ~03:50 UTC - Physics Time Scaling Fix

**User request:** Time scaling causes jitter and velocity changes. Want physics speed to control simulation rate, not alter velocities.

**Work completed:**
- Changed from multiplying delta time by speed factor to using `Time<Virtual>::set_relative_speed()`
- Physics steps stay constant size, but more/fewer run per frame at different speeds
- Velocities now remain consistent at any playback speed

**Files changed:** `src/main.rs`

**Commit:** `10e0b20` - Use Virtual time for physics scaling and add segment locality optimization

---

## ~04:00 UTC - Render Interpolation for Smooth Movement

**User request:** Marbles have a pulsing effect while rolling (except camera-tracked marble). Suspected collision resolution issue.

**Root cause:** Fixed timestep physics (64 Hz) doesn't align with variable framerate rendering (60+ FPS), causing marbles to "jump" between discrete positions.

**Work completed:**
- Added `previous_position` and `physics_position` fields to Marble component
- Separated physics state from render state completely
- Physics systems read/write `physics_position` as source of truth
- New `marble_interpolation` system lerps between physics frames using `overstep_fraction()`
- Transform.translation only modified by interpolation for rendering

**Files changed:** `src/main.rs`

**Commit:** `f185c4a` - Add render interpolation for smooth marble movement

---

## ~04:15 UTC - Session Logging Setup

**User request:** Add rule to claude.md about keeping session logs with dates/times in a subfolder.

**Work completed:**
- Updated `claude.md` with session logging instructions
- Created `docs/logs/` folder
- Created this log file

**Files changed:** `claude.md`, `docs/logs/2026-01-08.md`

---

## ~20:45 UTC - CurvedTube Segment Junction Fix

**User request:** Test segment joins by creating a track with straight pipe followed by curved pipe. Marbles were experiencing transition bumps and crazy bouncing in the curve.

**Root cause:** Multiple issues:
1. Cross product direction was wrong (`Y.cross(entry_dir)` gave left instead of right)
2. Arc angle was being added instead of subtracted, causing curve to extend backward
3. SDF discontinuities at segment junctions caused gradient spikes

**Work completed:**
- Fixed cross product to `entry_dir.cross(Y)` for correct right vector
- Changed arc angle to subtract instead of add for correct curve direction
- Added 1-unit straight lead-in segment to CurvedTube that exactly matches entry direction
- Lead-in ensures seamless SDF transition from StraightTube
- Arc now starts from end of lead-in, not from entry point
- SDF uses polyline closest-point distance with rejection for points behind entry

**Testing:** All 8 marbles now transition smoothly from straight tube to curved tube

**Files changed:** `src/track/segments/curved_tube.rs`, `src/main.rs`
